<!DOCTYPE html>
<html>
<head>
    <title>Mandelbrot Fractal Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        canvas {
            border: 2px solid #333;
            background-color: #000;
            margin-bottom: 20px;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        .controls {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 600px;
        }
        button {
            padding: 8px 16px;
            margin: 0 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .coord-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }
        .coord-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .coord-group label {
            min-width: 100px;
        }
        input[type="number"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            flex: 1;
        }
        .instructions {
            margin-bottom: 10px;
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="instructions">Enter coordinates and click Zoom to focus on that area</div>
    <canvas id="FractalCanvas" width="900" height="600"></canvas>
    <div class="controls">
        <div class="coord-inputs">
            <div class="coord-group">
                <label>Top Left X:</label>
                <input type="number" id="topLeftX" value="-2" step="0.1">
            </div>
            <div class="coord-group">
                <label>Top Left Y:</label>
                <input type="number" id="topLeftY" value="-1" step="0.1">
            </div>
            <div class="coord-group">
                <label>Bottom Right X:</label>
                <input type="number" id="bottomRightX" value="1" step="0.1">
            </div>
            <div class="coord-group">
                <label>Bottom Right Y:</label>
                <input type="number" id="bottomRightY" value="1" step="0.1">
            </div>
        </div>
        <button onclick="handleZoom()">Zoom</button>
        <button onclick="resetView()">Reset View</button>
    </div>
    <script>
        var element = document.getElementById('FractalCanvas');
        var ctx = element.getContext('2d');
        var topLeft = new bound(new CNum(-2, -1), new Coord(0,0));
        var bottomRight = new bound(new CNum(1, 1), null);
        var mouseDownCoord, mouseUpCoord, mousePressed = false;
        var colour = new RGB(0.2*255,0.9*99,0.3*71);
        var portionOfScreen = 0.4;
        var imgData;
        var minIterations;

        //Hard coded due to Javascript being crap
        var width = Math.round(portionOfScreen * screen.height) * 3;
        var height = Math.round(portionOfScreen * screen.height) * 2;
        var heightWidthRatio = height / width;
        var set = new TwoDArray(width, height);

        window.onload = initialise();

        function initialise() {
            minIterations = 255;
            element.height = height;
            element.width = width;

            calculateSet(set);
            drawSet(0, 0, width, height);
        }

        function resetView() {
            topLeft = new bound(new CNum(-2, -1), new Coord(0,0));
            bottomRight = new bound(new CNum(1, 1), null);
            document.getElementById('topLeftX').value = -2;
            document.getElementById('topLeftY').value = -1;
            document.getElementById('bottomRightX').value = 1;
            document.getElementById('bottomRightY').value = 1;
            initialise();
        }

        function handleZoom() {
            const topLeftX = parseFloat(document.getElementById('topLeftX').value);
            const topLeftY = parseFloat(document.getElementById('topLeftY').value);
            const bottomRightX = parseFloat(document.getElementById('bottomRightX').value);
            const bottomRightY = parseFloat(document.getElementById('bottomRightY').value);

            if (isNaN(topLeftX) || isNaN(topLeftY) || isNaN(bottomRightX) || isNaN(bottomRightY)) {
                alert('Please enter valid numbers for all coordinates');
                return;
            }

            topLeft = new bound(new CNum(topLeftX, topLeftY), new Coord(0,0));
            bottomRight = new bound(new CNum(bottomRightX, bottomRightY), null);
            initialise();
        }

        function bound(axis, coord) {
            this.axis = axis;
            this.coord = coord;
        }

        function CNum(Re, Im){
            this.Re = Re;
            this.Im = Im;
        }

        function Coord(x, y){
            this.x = x;
            this.y = y;
        }

        function TwoDArray(x, y) {
            var a = new Array(x);
            for(var i = 0; i < x; i++){
                a[i] = new Array(y);
            }
            return a;
        }

        function getCoordinates(event) {
            var rect = element.getBoundingClientRect();
            var x, y;
            
            if (event.touches && event.touches.length > 0) {
                x = event.touches[0].clientX - rect.left;
                y = event.touches[0].clientY - rect.top;
            } else {
                x = event.clientX - rect.left;
                y = event.clientY - rect.top;
            }
            
            return new Coord(x, y);
        }

        function handleStart(event) {
            event.preventDefault();
            event.stopPropagation();
            mouseDownCoord = getCoordinates(event);
            mousePressed = true;
            return false;
        }

        function handleMove(event) {
            if (!mousePressed) return;
            
            event.preventDefault();
            event.stopPropagation();
            
            mouseUpCoord = getCoordinates(event);

            ctx.putImageData(imgData,0,0);

            var xDiff = (mouseUpCoord.x - mouseDownCoord.x) + 1;
            var yDiff = (mouseUpCoord.y - mouseDownCoord.y);
            if ((yDiff / xDiff) < heightWidthRatio) {
                xDiff = yDiff / heightWidthRatio;
                mouseUpCoord.x = mouseDownCoord.x + xDiff;
            } else {
                yDiff = heightWidthRatio * xDiff;
                mouseUpCoord.y = mouseDownCoord.y + yDiff;
            }

            ctx.fillStyle="gray";
            ctx.fillRect(mouseDownCoord.x, mouseDownCoord.y, xDiff, yDiff);
            mouseUpCoord.x = mouseDownCoord.x + xDiff;
            mouseUpCoord.y = mouseDownCoord.y + yDiff;

            ctx.globalAlpha=0.2;
            ctx.stroke();
            
            return false;
        }

        function handleEnd(event) {
            if (!mousePressed) return;
            
            event.preventDefault();
            event.stopPropagation();
            mousePressed = false;

            if (mouseUpCoord.y < mouseDownCoord.y) {
                var tempSwap = mouseDownCoord;
                mouseDownCoord = mouseUpCoord;
                mouseUpCoord = tempSwap;
            }
            
            var temptopLeft = new bound(coordinatesToAxis(mouseDownCoord), mouseDownCoord);
            var tempbottomRight = new bound(coordinatesToAxis(mouseUpCoord), mouseUpCoord);
            
            topLeft = temptopLeft;
            bottomRight = tempbottomRight;
            
            // Update input fields with new coordinates
            document.getElementById('topLeftX').value = topLeft.axis.Re.toFixed(2);
            document.getElementById('topLeftY').value = topLeft.axis.Im.toFixed(2);
            document.getElementById('bottomRightX').value = bottomRight.axis.Re.toFixed(2);
            document.getElementById('bottomRightY').value = bottomRight.axis.Im.toFixed(2);
            
            initialise();
            return false;
        }

        // Mouse events
        FractalCanvas.onmousedown = handleStart;
        FractalCanvas.onmousemove = handleMove;
        FractalCanvas.onmouseup = handleEnd;
        FractalCanvas.onmouseleave = handleEnd;

        // Touch events
        FractalCanvas.addEventListener('touchstart', handleStart, { passive: false });
        FractalCanvas.addEventListener('touchmove', handleMove, { passive: false });
        FractalCanvas.addEventListener('touchend', handleEnd, { passive: false });
        FractalCanvas.addEventListener('touchcancel', handleEnd, { passive: false });

        function drawSet(xStart, yStart, xEnd, yEnd){
            imgData = ctx.createImageData(xEnd,yEnd);
            var i = 0;
            var dampener = 3.3;

            for(var y = yStart; y < set[0].length; y++){
                for(var x = xStart; x < set.length; x ++){
                    set[x][y] = stretchColour(set[x][y]);
                    imgData.data[4*i+0]=Math.round((colour.red / 255)*set[x][y] * dampener);
                    imgData.data[4*i+1]=Math.round((colour.green / 255)*set[x][y] * dampener);
                    imgData.data[4*i+2]=Math.round((colour.blue / 255)*set[x][y] * dampener);
                    imgData.data[4*i+3]=200;
                    i++;
                }
            }
            ctx.putImageData(imgData,xStart,yStart);
        }

        function stretchColour(val) {
            return (val - minIterations) / (1 - (minIterations / 255));
        }

        function RGB(red, green, blue) {
            this.red = red;
            this.green = green;
            this.blue = blue;
        }

        function coordinatesToAxis(coordinates){
            var scale = width / (bottomRight.axis.Re - topLeft.axis.Re);
            return(new CNum((coordinates.x / scale) + topLeft.axis.Re,
                          (coordinates.y / scale) + topLeft.axis.Im));
        }

        function calculateSet() {
            var tempCoord, tempCNum;
            for (var x = 0; x < set.length; x++) {
                for (var y = 0; y < set[0].length; y++) {
                    tempCoord = new Coord(x, y);
                    tempCNum = coordinatesToAxis(tempCoord);
                    set[x][y] = iterate(tempCNum);
                    if (set[x][y] < minIterations) {
                        minIterations = set[x][y];
                    }
                }
            }
            return set;
        }

        function iterate(c) {
            var tempZ = new CNum(0,0), Z = new CNum(0,0);
            var valueLimit = 4, iterations = 0, iterationLimit = 255;
            while((Z.Re*Z.Re+Z.Im*Z.Im) < valueLimit && iterations < iterationLimit){
                tempZ.Re = Z.Re * Z.Re - Z.Im * Z.Im + c.Re
                tempZ.Im = 2 * Z.Re * Z.Im + c.Im

                Z.Re = tempZ.Re
                Z.Im = tempZ.Im
                iterations++
            }
            return iterations;
        }
    </script>
</body>
</html> 